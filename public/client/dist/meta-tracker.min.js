"use strict";var MetaTrackerBundle=(()=>{var A=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var ee=Object.prototype.hasOwnProperty;var te=(e,t)=>{for(var n in t)A(e,n,{get:t[n],enumerable:!0})},ne=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of G(t))!ee.call(e,a)&&a!==n&&A(e,a,{get:()=>t[a],enumerable:!(r=Z(t,a))||r.enumerable});return e};var re=e=>ne(A({},"__esModule",{value:!0}),e);var ye={};te(ye,{MetaTracker:()=>T,default:()=>he});var k="2.1.0";var L=[1e3,5e3,15e3],U=2e3,i={endpoint:"",apiKey:"",pixelId:"",pixels:[],autoPageView:!0,debug:!1,hashPii:!0,respectDnt:!1,batchEvents:!0,cookieKeeper:{enabled:!0,refreshInterval:864e5,maxAge:180,cookieNames:["_fbp","_fbc","_mt_id"]},adBlockRecovery:{enabled:!0,proxyPath:"/collect",useBeacon:!0,useImage:!0,customEndpoints:[]},browserPixel:{enabled:!1,autoPageView:!0,syncEvents:!0},consent:{enabled:!1,mode:"opt-in",consentCategory:"C0004",waitForConsent:!0,defaultConsent:!1},advancedMatching:{enabled:!0,autoCaptureForms:!0,captureUrlParams:!0,captureDataLayer:!0,captureMetaTags:!0,autoIdentifyOnSubmit:!0,formFieldMap:{},dataLayerKey:"dataLayer",userDataKey:null}},v=[],C=null,w=!1,_="fetch",m=!1,M=null;function O(e){Object.assign(i,e,{browserPixel:{...i.browserPixel,...e.browserPixel??{}},consent:{...i.consent,...e.consent??{}},cookieKeeper:{...i.cookieKeeper,...e.cookieKeeper??{}},adBlockRecovery:{...i.adBlockRecovery,...e.adBlockRecovery??{}},advancedMatching:{...i.advancedMatching,...e.advancedMatching??{}}})}function j(e){w=e}function H(e){_=e}function N(e){m=e}function $(e){C=e}function K(e){M=e}function c(...e){i.debug&&console.log("[MetaTracker]",...e)}function f(...e){i.debug&&console.warn("[MetaTracker]",...e)}async function z(e){if(!e)return null;let t=new TextEncoder().encode(e.toString().trim().toLowerCase()),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(r=>r.toString(16).padStart(2,"0")).join("")}function E(e){return typeof e=="string"&&/^[a-f0-9]{64}$/.test(e)}function B(){return`evt_${Date.now().toString(36)}_${Math.random().toString(36).substring(2,10)}`}function V(){let e=l("_mt_id");if(e)return e;let t="mt."+Date.now().toString(36)+"."+Math.random().toString(36).substring(2,12);return y("_mt_id",t),t}function Q(){try{let e=window.location.hostname.split(".");return e.length<=1||/^\d+$/.test(e[e.length-1])?"":e.slice(-2).join(".")}catch{return""}}function I(e,t,n){let r=n*86400,a=location.protocol==="https:"?"; Secure":"",o=Q(),s=o?`; domain=.${o}`:"";document.cookie=`${e}=${encodeURIComponent(t)}; path=/${s}; max-age=${r}; SameSite=Lax${a}`}function S(e){let t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?decodeURIComponent(t[2]):null}function ae(e){let t=Q();document.cookie=`${e}=; path=/${t?`; domain=.${t}`:""}; max-age=0`}function l(e){let t=S(e);if(t)return t;try{return localStorage.getItem("mt_"+e)}catch{return null}}function y(e,t,n){n=n??(i.cookieKeeper.maxAge||180),I(e,t,n);try{localStorage.setItem("mt_"+e,t)}catch{}}function q(e){ae(e);try{localStorage.removeItem("mt_"+e)}catch{}}var h={async detect(){if(!i.adBlockRecovery.enabled)return!1;try{let e=i.endpoint.replace(/\/track\/?$/,"")+"/health",t=new AbortController,n=setTimeout(()=>t.abort(),3e3),r=await fetch(e,{method:"GET",signal:t.signal,cache:"no-store"});if(clearTimeout(n),!r.ok)throw new Error("Blocked");return!1}catch{return N(!0),c("AdBlockRecovery: DETECTED"),!0}},getEndpoint(e){return m&&i.adBlockRecovery.proxyPath?i.endpoint.replace(/\/api\/v1\/track\/?$/,"")+i.adBlockRecovery.proxyPath+e:i.endpoint+e},getFallbackEndpoints(e){let t=[this.getEndpoint(e)];for(let n of i.adBlockRecovery.customEndpoints??[])t.push(n+e);return t},disguisePayload(e){return m?{d:btoa(JSON.stringify(e)),t:Date.now(),v:k}:e},getHeaders(){let e={"Content-Type":"application/json"};return e[m?"X-Request-Token":"X-API-Key"]=i.apiKey,e}};function x(e){return m?h.getEndpoint(e):i.endpoint+e}async function ie(e,t){let n=m?h.disguisePayload(t):t,r=await fetch(e,{method:"POST",headers:h.getHeaders(),body:JSON.stringify(n),keepalive:!0,credentials:"include"});if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json().catch(()=>({}))}function oe(e,t){let n=m?h.disguisePayload(t):t,r=new Blob([JSON.stringify(n)],{type:"application/json"});if(!navigator.sendBeacon(e+"?api_key="+encodeURIComponent(i.apiKey),r))throw new Error("Beacon failed");return Promise.resolve({sent:!0})}function se(e,t){return new Promise((n,r)=>{let a=new XMLHttpRequest;a.open("POST",e,!0);for(let[s,d]of Object.entries(h.getHeaders()))a.setRequestHeader(s,d);a.withCredentials=!0,a.timeout=1e4,a.onload=()=>a.status>=200&&a.status<300?n(JSON.parse(a.responseText||"{}")):r(new Error(`XHR ${a.status}`)),a.onerror=()=>r(new Error("XHR error")),a.ontimeout=()=>r(new Error("XHR timeout"));let o=m?h.disguisePayload(t):t;a.send(JSON.stringify(o))})}function ce(e,t){return new Promise((n,r)=>{let a=new URLSearchParams({d:btoa(JSON.stringify(t)),k:i.apiKey,t:Date.now().toString()}),o=e.replace(/\/(event|batch)$/,"/pixel.gif")+"?"+a;if(o.length>4e3){r(new Error("Payload too large"));return}let s=new Image(1,1);s.onload=()=>n({sent:!0}),s.onerror=()=>r(new Error("Image pixel failed")),s.src=o})}async function R(e,t,n=0){let r=[{name:"fetch",fn:ie},{name:"beacon",fn:oe,skip:!i.adBlockRecovery.useBeacon},{name:"xhr",fn:se},{name:"img",fn:ce,skip:!i.adBlockRecovery.useImage}].filter(a=>!a.skip);for(let a of r){let o=e.includes(i.endpoint)?e.replace(i.endpoint,""):e.replace(/^https?:\/\/[^/]+/,"").replace(/.*\/api\/v1\/track/,""),s=m?h.getFallbackEndpoints(o):[e];for(let d of s)try{let p=await a.fn(d,t);return a.name!==_&&(c(`Transport: ${_} \u2192 ${a.name}`),H(a.name)),p}catch(p){c(`${a.name} \u2192 ${d}: ${p.message}`)}}if(n<L.length)return new Promise(a=>setTimeout(()=>a(R(e,t,n+1)),L[n]));f("All transports exhausted")}var g={init(){i.cookieKeeper.enabled&&(this.restoreCookies(),this.captureFbclid(),this.ensureFbp(),this.ensureVisitorId(),this.syncToServer(),this.scheduleRefresh(),c("CookieKeeper: ready",{fbp:this.getFbp(),fbc:this.getFbc()}))},restoreCookies(){for(let e of i.cookieKeeper.cookieNames??[])if(S(e))try{localStorage.setItem("mt_"+e,S(e))}catch{}else try{let t=localStorage.getItem("mt_"+e);t&&I(e,t,i.cookieKeeper.maxAge)}catch{}},captureFbclid(){try{let e=new URL(window.location.href).searchParams.get("fbclid");e&&y("_fbc",`fb.1.${Math.floor(Date.now()/1e3)}.${e}`,i.cookieKeeper.maxAge)}catch{}},ensureFbp(){l("_fbp")||y("_fbp",`fb.1.${Date.now()}.${Math.floor(Math.random()*2147483647)}`,i.cookieKeeper.maxAge)},ensureVisitorId(){l("_mt_id")||V()},async syncToServer(){let e={_fbp:l("_fbp"),_fbc:l("_fbc"),_mt_id:l("_mt_id"),_mt_em:l("_mt_em"),_mt_ph:l("_mt_ph")};if(!e._fbp&&!e._fbc&&!e._mt_id)return;let t=l("_mt_cookie_sync");if(!(t&&Date.now()-parseInt(t,10)<i.cookieKeeper.refreshInterval))try{await R(x("/cookie-sync"),{cookies:e,domain:window.location.hostname,max_age:i.cookieKeeper.maxAge}),y("_mt_cookie_sync",Date.now().toString(),1)}catch(n){f("CookieKeeper: sync failed",n.message)}},refreshCookies(){for(let e of i.cookieKeeper.cookieNames??[]){let t=l(e);t&&I(e,t,i.cookieKeeper.maxAge)}y("_mt_cookie_sync","0",1),this.syncToServer()},scheduleRefresh(){M&&clearInterval(M),K(setInterval(()=>this.refreshCookies(),i.cookieKeeper.refreshInterval)),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.restoreCookies()})},getFbp(){return l("_fbp")},getFbc(){return l("_fbc")},getVisitorId(){return l("_mt_id")}};var P={resolve(e){if(e=e??window.location.hostname,!i.pixels?.length)return i.pixelId?[i.pixelId]:[];let t=[],n=null;for(let r of i.pixels)if(!(!r.pixelId||!r.domains))for(let a of r.domains){if(a==="*"){n=r.pixelId;continue}if(this.matchDomain(e,a)){t.push(r.pixelId);break}}return!t.length&&n&&t.push(n),[...new Set(t)]},matchDomain(e,t){if(e===t)return!0;if(t.startsWith("*.")){let n=t.substring(2);return e.endsWith("."+n)||e===n}return e.endsWith("."+t)},getAllPixelIds(){return i.pixels?.length?[...new Set(i.pixels.map(e=>e.pixelId).filter(Boolean))]:i.pixelId?[i.pixelId]:[]}};var b={},Y={em(e){return e?(e=e.trim().toLowerCase(),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?e:null):null},ph(e){if(!e)return null;let t=e.replace(/\D/g,"");return t.length<7?null:(t.startsWith("00")&&(t=t.substring(2)),t||null)},fn(e){if(!e)return null;e=e.trim().toLowerCase().replace(/^(mr|mrs|ms|miss|dr|prof)\.?\s*/i,""),e=e.replace(/[^a-z\s\u00C0-\u024F]/g,"");try{e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}catch{}return e.trim()||null},ln(e){return Y.fn(e)},ge(e){return e?(e=e.trim().toLowerCase(),e.startsWith("m")||e==="male"?"m":e.startsWith("f")||e==="female"?"f":null):null},db(e){if(!e)return null;if(e=e.trim(),/^\d{8}$/.test(e))return e;let t=[/^(\d{4})-(\d{2})-(\d{2})$/,/^(\d{2})\/(\d{2})\/(\d{4})$/,/^(\d{2})-(\d{2})-(\d{4})$/];for(let n of t){let r=e.match(n);if(r)return r[1].length===4?r[1]+r[2]+r[3]:r[3]+r[1]+r[2]}return null},ct(e){if(!e)return null;e=e.trim().toLowerCase().replace(/[^a-z\s\u00C0-\u024F]/g,"");try{e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}catch{}return e.trim()||null},st(e){if(!e)return null;if(e=e.trim().toLowerCase(),/^[a-z]{2}$/.test(e))return e;let t=e.match(/\b([a-z]{2})\b/);return t?t[1]:e.substring(0,2)},zp(e){return e?(e=e.trim().toLowerCase().replace(/\s+/g,""),/^\d{5}(-\d{4})?$/.test(e)?e.substring(0,5):e||null):null},country(e){return e?(e=e.trim().toLowerCase(),/^[a-z]{2}$/.test(e)?e:{"united states":"us",usa:"us","united kingdom":"gb",uk:"gb",canada:"ca",australia:"au",germany:"de",france:"fr",indonesia:"id",japan:"jp",india:"in",brazil:"br",mexico:"mx",spain:"es",italy:"it",netherlands:"nl",singapore:"sg",malaysia:"my",philippines:"ph",thailand:"th",vietnam:"vn","south korea":"kr",china:"cn",taiwan:"tw","hong kong":"hk","new zealand":"nz",portugal:"pt",sweden:"se",norway:"no",denmark:"dk",finland:"fi",poland:"pl",cambodia:"kh",turkey:"tr",argentina:"ar",colombia:"co",chile:"cl",peru:"pe","south africa":"za",nigeria:"ng",egypt:"eg","saudi arabia":"sa","united arab emirates":"ae",uae:"ae",russia:"ru",ukraine:"ua",ireland:"ie",switzerland:"ch",austria:"at",belgium:"be","czech republic":"cz",romania:"ro"}[e]??(e.length===2?e:null)):null},external_id(e){return e?.trim()||null}},le={em:{types:["email"],names:["email","e-mail","user_email","userEmail","customer_email","login","username","emailAddress","email_address"],ids:["email","user-email","customer-email","signup-email","login-email"],autocomplete:["email"],placeholders:["email","e-mail","your email","email address"]},ph:{types:["tel"],names:["phone","telephone","tel","mobile","phone_number","phoneNumber","cell","cellphone","mobile_number","contact_number","whatsapp"],ids:["phone","telephone","mobile","phone-number"],autocomplete:["tel","tel-national","tel-local"],placeholders:["phone","telephone","mobile","whatsapp","nomor telepon","hp"]},fn:{names:["first_name","firstName","fname","given-name","givenName","first","name_first","billing_first_name"],ids:["first-name","firstname","fname","given-name"],autocomplete:["given-name"],placeholders:["first name","given name","nama depan"]},ln:{names:["last_name","lastName","lname","family-name","familyName","surname","last","name_last","billing_last_name"],ids:["last-name","lastname","lname","family-name","surname"],autocomplete:["family-name"],placeholders:["last name","family name","surname","nama belakang"]},ct:{names:["city","town","billing_city","shipping_city","address_city"],ids:["city","billing-city","shipping-city"],autocomplete:["address-level2"],placeholders:["city","town","kota"]},st:{names:["state","province","region","billing_state","shipping_state"],ids:["state","province","region","billing-state"],autocomplete:["address-level1"],placeholders:["state","province","region","provinsi"]},zp:{names:["zip","zipcode","zip_code","postal","postal_code","postcode","billing_zip","billing_postcode","shipping_zip"],ids:["zip","zipcode","postal-code","postcode"],autocomplete:["postal-code"],placeholders:["zip","postal code","zip code","kode pos"]},country:{names:["country","country_code","countryCode","billing_country","shipping_country"],ids:["country","billing-country","shipping-country"],autocomplete:["country","country-name"],placeholders:["country","negara"]},ge:{names:["gender","sex"],ids:["gender","sex"],autocomplete:["sex"],placeholders:["gender","jenis kelamin"]},db:{names:["birthday","birthdate","date_of_birth","dob","dateOfBirth","birth_date","bday"],ids:["birthday","birthdate","dob","date-of-birth"],autocomplete:["bday"],placeholders:["birthday","date of birth","tanggal lahir"]}},X={explicit:100,identify:90,form:80,form_prefill:70,url:60,dataLayer:50,customDataLayer:50,metatag:30},de={email:"em",em:"em",user_email:"em",customerEmail:"em",phone:"ph",ph:"ph",telephone:"ph",mobile:"ph",phoneNumber:"ph",first_name:"fn",fn:"fn",firstName:"fn",givenName:"fn",last_name:"ln",ln:"ln",lastName:"ln",familyName:"ln",surname:"ln",gender:"ge",ge:"ge",sex:"ge",date_of_birth:"db",db:"db",birthday:"db",dob:"db",birthdate:"db",city:"ct",ct:"ct",town:"ct",state:"st",st:"st",province:"st",region:"st",zip:"zp",zp:"zp",zipcode:"zp",postal_code:"zp",postcode:"zp",country:"country",country_code:"country",countryCode:"country",external_id:"external_id",user_id:"external_id",userId:"external_id",customer_id:"external_id",customerId:"external_id"},J={email:"em",phone:"ph",first_name:"fn",last_name:"ln",gender:"ge",date_of_birth:"db",city:"ct",state:"st",zip:"zp",zipcode:"zp",postal_code:"zp"},W={em:"_mt_em",ph:"_mt_ph",external_id:"_mt_eid",fn:"_mt_fn",ln:"_mt_ln",ct:"_mt_ct",st:"_mt_st",zp:"_mt_zp",country:"_mt_country"},ue=["em","ph","fn","ln","ge","db","ct","st","zp","country","external_id"],me=["client_ip_address","client_user_agent","fbc","fbp","subscription_id","fb_login_id","lead_id"],u={init(){i.advancedMatching.enabled&&(c("AdvancedMatching: initializing"),i.advancedMatching.captureUrlParams&&this.captureFromUrl(),i.advancedMatching.captureMetaTags&&this.captureFromMetaTags(),i.advancedMatching.captureDataLayer&&this.captureFromDataLayer(),i.advancedMatching.autoCaptureForms&&this.watchForms(),c("AdvancedMatching: ready, captured:",Object.keys(b)))},normalize(e,t){if(E(t))return t;let n=Y[e];return n?n(t):t?String(t).trim().toLowerCase():null},async normalizeAndHash(e){if(!e)return{};let t={};for(let n of ue){let r=e[n];if(!r)continue;if(E(r)){t[n]=r;continue}let a=this.normalize(n,r);a&&(t[n]=i.hashPii?await z(a)??void 0:a)}for(let n of me)e[n]&&(t[n]=e[n]);return t},detectFieldParam(e){let t=(e.type||"").toLowerCase(),n=(e.name||"").toLowerCase(),r=(e.id||"").toLowerCase(),a=(e.autocomplete||"").toLowerCase(),o=("placeholder"in e&&e.placeholder||"").toLowerCase();for(let[s,d]of Object.entries(i.advancedMatching.formFieldMap??{}))try{if(e.matches(s))return d}catch{}for(let[s,d]of Object.entries(le))if(d.types?.includes(t)||d.names?.some(p=>n.includes(p))||d.ids?.some(p=>r.includes(p))||d.autocomplete?.includes(a)||d.placeholders?.some(p=>o.includes(p)))return s;return["name","full_name","fullname","customer_name"].includes(n)||["name","full-name","fullname"].includes(r)?"_fullname":null},scanForm(e){let t={},n=e.querySelectorAll("input, select, textarea");for(let r of n){if(["hidden","password","submit"].includes(r.type))continue;let a=r.value?.trim();if(!a)continue;let o=this.detectFieldParam(r);if(o)if(o==="_fullname"){let s=a.split(/\s+/);s.length>=2?(t.fn=t.fn||s[0],t.ln=t.ln||s.slice(1).join(" ")):t.fn=t.fn||a}else t[o]=t[o]||a}return t},watchForms(){document.addEventListener("submit",e=>{let t=e.target;if(!(t instanceof HTMLFormElement))return;let n=this.scanForm(t);Object.keys(n).length&&(this._mergeCapture("form",n),c("AdvancedMatching: form submit captured",Object.keys(n)),i.advancedMatching.autoIdentifyOnSubmit&&(n.em||n.ph)&&window.MetaTracker?.identify(n))},!0),document.addEventListener("change",e=>{let t=e.target;if(!(t instanceof HTMLInputElement)&&!(t instanceof HTMLSelectElement))return;let n=t.value?.trim();if(!n)return;let r=this.detectFieldParam(t);!r||r==="_fullname"||(this._mergeCapture("form",{[r]:n}),c("AdvancedMatching: field captured",r))},!0);var pe=()=>{document.querySelectorAll("form").forEach(e=>{let t=this.scanForm(e);Object.keys(t).length&&(this._mergeCapture("form_prefill",t),c("AdvancedMatching: pre-filled form scanned",Object.keys(t)))});if(typeof MutationObserver<"u"&&document.body){new MutationObserver(t=>{for(let n of t)for(let r of n.addedNodes){if(!(r instanceof HTMLElement))continue;let a=r.tagName==="FORM"?[r]:[...r.querySelectorAll("form")];for(let o of a){let s=this.scanForm(o);Object.keys(s).length&&this._mergeCapture("form_prefill",s)}}}).observe(document.body,{childList:!0,subtree:!0})}};document.body?pe():document.addEventListener("DOMContentLoaded",pe)},captureFromUrl(){try{let e=new URL(window.location.href).searchParams,t={};for(let o of["email","em","e","user_email","customer_email"]){let s=e.get(o);if(s?.includes("@")){t.em=s;break}}for(let o of["phone","ph","tel","mobile","whatsapp"]){let s=e.get(o);if(s&&s.replace(/\D/g,"").length>=7){t.ph=s;break}}let n=e.get("first_name")??e.get("fn");n&&(t.fn=n);let r=e.get("last_name")??e.get("ln");r&&(t.ln=r);for(let o of["external_id","eid","user_id","uid","customer_id","player_id"]){let s=e.get(o);if(s){t.external_id=s;break}}let a=e.get("country")??e.get("cc");a&&(t.country=a),Object.keys(t).length&&(this._mergeCapture("url",t),c("AdvancedMatching: URL params captured",Object.keys(t)))}catch{}},captureFromDataLayer(){let e=i.advancedMatching.dataLayerKey||"dataLayer",t=window[e];if(Array.isArray(t)){for(let a of t)this._extractFromDataLayerEntry(a);let r=t.push.bind(t);t.push=(...a)=>{let o=r(...a);for(let s of a)this._extractFromDataLayerEntry(s);return o}}let n=i.advancedMatching.userDataKey;n&&window[n]&&this._extractUserObject(window[n],"customDataLayer")},_extractFromDataLayerEntry(e){if(!e||typeof e!="object")return;let t=e;for(let a of["user","userData","user_data","customer","visitor","contact"])t[a]&&typeof t[a]=="object"&&this._extractUserObject(t[a],"dataLayer");let r=t.ecommerce?.purchase?.actionField;r?.email&&this._mergeCapture("dataLayer",{em:r.email}),this._extractUserObject(t,"dataLayer")},_extractUserObject(e,t){if(!e)return;let n={};for(let[r,a]of Object.entries(de)){let o=e[r];o&&typeof o=="string"&&o.trim()&&(n[a]=o.trim())}Object.keys(n).length&&(this._mergeCapture(t,n),c("AdvancedMatching: data layer captured",Object.keys(n)))},captureFromMetaTags(){let e={};for(let n of document.querySelectorAll('script[type="application/ld+json"]'))try{let r=JSON.parse(n.textContent||"");if(r.email&&(e.em=r.email),r.telephone&&(e.ph=r.telephone),r.givenName&&(e.fn=r.givenName),r.familyName&&(e.ln=r.familyName),r.address&&typeof r.address=="object"){let a=r.address;a.addressLocality&&(e.ct=a.addressLocality),a.addressRegion&&(e.st=a.addressRegion),a.postalCode&&(e.zp=a.postalCode),a.addressCountry&&(e.country=a.addressCountry)}}catch{}let t=n=>document.querySelector(`meta[property="${n}"]`)?.content;t("profile:email")&&(e.em=t("profile:email")),t("profile:first_name")&&(e.fn=t("profile:first_name")),t("profile:last_name")&&(e.ln=t("profile:last_name")),t("profile:gender")&&(e.ge=t("profile:gender")),Object.keys(e).length&&(this._mergeCapture("metatag",e),c("AdvancedMatching: meta tags captured",Object.keys(e)))},_mergeCapture(e,t){for(let[n,r]of Object.entries(t)){if(!r)continue;let a=b[n],o=a?X[a.source]??0:-1;(!a||(X[e]??0)>=o)&&(b[n]={value:r,source:e})}},getCapturedData(){let e={};for(let[t,n]of Object.entries(b))e[t]=n.value;return e},async buildUserData(e={}){let t={...this.getCapturedData()};for(let[r,a]of Object.entries(W))if(!t[r]&&a){let o=l(a);o&&(t[r]=o)}for(let[r,a]of Object.entries(e))a&&(t[J[r]??r]=a);let n=await this.normalizeAndHash(t);if(n.fbp=n.fbp||g.getFbp()||void 0,n.fbc=n.fbc||g.getFbc()||void 0,n.client_user_agent=n.client_user_agent||navigator.userAgent,!n.external_id){let r=g.getVisitorId();r&&(n.external_id=await z(r)??void 0)}return n},scoreMatchQuality(e){let t={em:30,ph:25,external_id:15,fn:5,ln:5,ct:3,st:2,zp:3,country:2,ge:2,db:3,fbp:5,fbc:10,client_ip_address:3,client_user_agent:2},n=0;for(let[r,a]of Object.entries(t))e[r]&&(n+=a);return Math.min(n,100)},getDiagnostics(){let e={};for(let[t,n]of Object.entries(b))e[t]={source:n.source,hasValue:!0,isHashed:E(n.value)};return{capturedFields:Object.keys(b).length,fields:e,storedIdentity:{em:!!l("_mt_em"),ph:!!l("_mt_ph"),fn:!!l("_mt_fn"),ln:!!l("_mt_ln"),external_id:!!l("_mt_eid")}}},resetCapturedData(){b={}},aliasMap:J,storageMap:W};var ve=["PageView","ViewContent","AddToCart","AddPaymentInfo","AddToWishlist","CompleteRegistration","Contact","CustomizeProduct","Donate","FindLocation","InitiateCheckout","Lead","Purchase","Schedule","Search","StartTrial","SubmitApplication","Subscribe"],bp={_loaded:!1,init(){if(!i.browserPixel||!i.browserPixel.enabled||this._loaded)return;if(typeof window.fbq=="function"){c("BrowserPixel: fbq already present"),this._initPixels(),this._loaded=!0;return}c("BrowserPixel: loading fbevents.js");var e=window.fbq=function(){e.callMethod?e.callMethod.apply(e,arguments):e.queue.push(arguments)};window._fbq||(window._fbq=e),e.push=e,e.loaded=!0,e.version="2.0",e.queue=[];var t=document.createElement("script");t.async=!0,t.src="https://connect.facebook.net/en_US/fbevents.js";var n=document.getElementsByTagName("script")[0];n&&n.parentNode?n.parentNode.insertBefore(t,n):document.body?(function(){var s=document.getElementsByTagName("script")[0];s&&s.parentNode?s.parentNode.insertBefore(t,s):document.head.appendChild(t)})():document.addEventListener("DOMContentLoaded",function(){var s=document.getElementsByTagName("script")[0];s&&s.parentNode?s.parentNode.insertBefore(t,s):document.head.appendChild(t)}),this._initPixels(),this._loaded=!0},_initPixels(){var e=P.getAllPixelIds();if(!e.length){f("BrowserPixel: no pixel IDs configured");return}for(var t of e)window.fbq("init",t),c("BrowserPixel: init pixel",t);i.browserPixel.autoPageView&&(window.fbq("track","PageView"),c("BrowserPixel: PageView fired"))},trackEvent(e,t,n){if(!i.browserPixel||!i.browserPixel.enabled||!i.browserPixel.syncEvents||typeof window.fbq!="function")return;var r=ve.includes(e),a={...n||{}},o={eventID:t};r?window.fbq("track",e,a,o):window.fbq("trackCustom",e,a,o),c("BrowserPixel: synced",e,"eventID:",t)}};var Le=[],Ce=null,cm={init(){if(!i.consent||!i.consent.enabled){Ce=!0;return}Ce=i.consent.mode==="opt-out"?i.consent.defaultConsent??!0:i.consent.defaultConsent??!1,c("ConsentManager: mode="+i.consent.mode,"default="+Ce),this._detectCMP()},_detectCMP(){if(typeof window.OneTrust<"u"||typeof window.OptanonWrapper<"u"){this._initOneTrust();return}if(typeof window.Cookiebot<"u"){this._initCookiebot();return}if(typeof window.truste<"u"){this._initTrustArc();return}if(typeof window.Osano<"u"){this._initOsano();return}if(typeof window.gtag=="function"){this._initGoogleConsentMode();return}if(typeof window.__tcfapi=="function"){this._initTCF();return}c("ConsentManager: no CMP detected, default="+Ce),i.consent.waitForConsent&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{typeof window.OneTrust<"u"?this._initOneTrust():typeof window.Cookiebot<"u"?this._initCookiebot():typeof window.truste<"u"?this._initTrustArc():typeof window.Osano<"u"?this._initOsano():typeof window.__tcfapi=="function"?this._initTCF():c("ConsentManager: no CMP after DOM ready")}):setTimeout(()=>{typeof window.OneTrust<"u"?this._initOneTrust():typeof window.Cookiebot<"u"?this._initCookiebot():typeof window.truste<"u"?this._initTrustArc():typeof window.Osano<"u"?this._initOsano():typeof window.__tcfapi=="function"?this._initTCF():c("ConsentManager: no CMP after DOM ready")},1e3))},_initOneTrust(){c("ConsentManager: OneTrust detected");var e=i.consent.consentCategory,t=()=>{var r=window.OnetrustActiveGroups||"";this._updateConsent(r.includes(e),"OneTrust")},n=window.OptanonWrapper;window.OptanonWrapper=function(){typeof n=="function"&&n(),t()},window.OnetrustActiveGroups&&t()},_initCookiebot(){c("ConsentManager: Cookiebot detected");var e=()=>{var t=window.Cookiebot;t&&this._updateConsent(t.consent?.marketing===!0,"Cookiebot")};window.addEventListener("CookiebotOnAccept",e),window.addEventListener("CookiebotOnDecline",e),window.Cookiebot?.consented&&e()},_initTrustArc(){c("ConsentManager: TrustArc detected");var e=()=>{try{var t=window.truste?.eu?.bindMap?.prefCookie;this._updateConsent(t!==void 0?parseInt(t,10)>=3:!1,"TrustArc")}catch{}};window.addEventListener("message",t=>{typeof t.data=="string"&&t.data.includes("truste.eu.cookie")&&setTimeout(e,100)}),e()},_initOsano(){c("ConsentManager: Osano detected");var e=window.Osano;typeof e?.cm?.addEventListener=="function"&&e.cm.addEventListener("osano-cm-consent-saved",t=>{this._updateConsent(t.MARKETING==="ACCEPT","Osano")}),typeof e?.cm?.getConsent=="function"&&(()=>{var t=e.cm.getConsent();t.MARKETING&&this._updateConsent(t.MARKETING==="ACCEPT","Osano")})()},_initGoogleConsentMode(){c("ConsentManager: Google Consent Mode detected");var e=window.dataLayer||[],t=e.push.bind(e);e.push=(...n)=>{var r=t(...n);for(var a of n)a&&typeof a=="object"&&a[0]==="consent"&&a[1]==="update"&&a[2]?.ad_storage&&this._updateConsent(a[2].ad_storage==="granted","GoogleConsentMode");return r};try{var n=window.google_tag_data?.ics?.entries;n?.ad_storage&&this._updateConsent(n.ad_storage.value==="granted","GoogleConsentMode")}catch{}},_initTCF(){c("ConsentManager: IAB TCF v2 detected");var e=()=>{window.__tcfapi("getTCData",2,(t,n)=>{if(!n||!t)return;if(!t.gdprApplies){this._updateConsent(!0,"TCF");return}var r=t.purpose?.consents??{};this._updateConsent(r[1]===!0&&r[4]===!0,"TCF")})};window.__tcfapi("addEventListener",2,(t,n)=>{n&&e()}),e()},_updateConsent(e,t){var n=Ce;Ce=e,n!==e&&c("ConsentManager: consent "+(e?"GRANTED":"REVOKED")+" via "+t),e&&Le.length&&this._flushPending()},_flushPending(){c("ConsentManager: flushing",Le.length,"queued calls");while(Le.length){var e=Le.shift(),t=T[e.method];typeof t=="function"&&t.apply(T,e.args)}},hasConsent(){return!i.consent||!i.consent.enabled?!0:Ce===!0},grantConsent(){this._updateConsent(!0,"manual")},revokeConsent(){this._updateConsent(!1,"manual")},queueIfNeeded(e,t){return!i.consent||!i.consent.enabled?!1:Ce===!0?!1:i.consent.waitForConsent?(Le.push({method:e,args:t}),c("ConsentManager: queued",e,"("+Le.length+" pending)"),!0):(f("ConsentManager: blocked",e,"(no consent)"),!0)}};async function fe(e){if(!e.length)return;let t=e.length===1?x("/event"):x("/batch"),n=e.length===1?e[0]:{events:e};try{await R(t,n)}catch(r){f("Send failed:",r)}}function D(){v.length&&fe(v.splice(0,50))}function ge(e){v.push(e),i.batchEvents?(C&&clearTimeout(C),$(setTimeout(D,U))):D()}var T={VERSION:k,async init(e){return w?(f("Already initialized"),this):!e.endpoint||!e.apiKey?(f("Missing: endpoint, apiKey"),this):!("pixelId"in e&&e.pixelId)&&!("pixels"in e&&e.pixels?.length)?(f("Missing: pixelId or pixels[]"),this):e.respectDnt&&(navigator.doNotTrack==="1"||window.doNotTrack==="1")?this:(O(e),j(!0),c("Initialized v"+k),g.init(),u.init(),bp.init(),cm.init(),i.adBlockRecovery.enabled&&h.detect().then(t=>{t&&c("Ad blocker recovery: ACTIVE")}),i.autoPageView&&this.trackPageView(),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&D()}),window.addEventListener("beforeunload",D),this)},async track(e,t={},n={},r={}){if(!w){f("Not initialized");return}if(cm.queueIfNeeded("track",[e,t,n,r]))return;let a=r.event_id??B(),o=i.advancedMatching.enabled?await u.buildUserData(n):await u.normalizeAndHash(n),s=u.scoreMatchQuality(o);c(`Match quality: ${s}/100`);let d=r.pixel_id?[r.pixel_id]:P.resolve();if(!d.length){f("No pixel for:",window.location.hostname);return}for(let p of d){let F={pixel_id:p,event_name:e,event_id:d.length>1?`${a}_${p.slice(-4)}`:a,event_time:Math.floor(Date.now()/1e3),event_source_url:window.location.href,action_source:r.action_source??"website",user_data:{...o},match_quality:s,visitor_id:g.getVisitorId()??null};Object.keys(t).length&&(F.custom_data=t),c("Track:",e,"\u2192",p,`(match: ${s})`),ge(F),bp.trackEvent(e,F.event_id,t)}return a},trackPageView(e={}){return this.track("PageView",{},e)},trackViewContent(e={},t={}){return this.track("ViewContent",e,t)},trackAddToCart(e={},t={}){return this.track("AddToCart",e,t)},trackPurchase(e={},t={}){return this.track("Purchase",e,t)},trackLead(e={},t={}){return this.track("Lead",e,t)},trackCompleteRegistration(e={},t={}){return this.track("CompleteRegistration",e,t)},trackInitiateCheckout(e={},t={}){return this.track("InitiateCheckout",e,t)},trackSearch(e={},t={}){return this.track("Search",e,t)},trackToPixel(e,t,n={},r={}){return this.track(t,n,r,{pixel_id:e})},async identify(e={}){if(!w){f("Not initialized");return}let t={};for(let[r,a]of Object.entries(e))a&&(t[u.aliasMap[r]??r]=a);let n=await u.normalizeAndHash(t);for(let[r,a]of Object.entries(u.storageMap)){let o=n[r];o&&a&&y(a,o,i.cookieKeeper.maxAge)}u._mergeCapture("identify",t),c("Identify:",Object.keys(n).filter(r=>n[r]&&!["client_user_agent","fbp","fbc"].includes(r))),g.syncToServer()},clearIdentity(){["_mt_em","_mt_ph","_mt_fn","_mt_ln","_mt_eid","_mt_ct","_mt_st","_mt_zp","_mt_country"].forEach(q),u.resetCapturedData(),c("Identity cleared")},addPixel(e,t){i.pixels.push({pixelId:e,domains:Array.isArray(t)?t:[t]})},removePixel(e){i.pixels=i.pixels.filter(t=>t.pixelId!==e)},refreshCookies(){g.refreshCookies()},hasConsent(){return cm.hasConsent()},grantConsent(){cm.grantConsent()},revokeConsent(){cm.revokeConsent()},flush(){D()},isAdBlocked(){return m},getTransport(){return _},getDebugInfo(){return{version:k,initialized:w,transport:_,adBlockDetected:m,config:{endpoint:i.endpoint,pixelId:i.pixelId,pixelCount:i.pixels.length},cookies:{fbp:g.getFbp(),fbc:g.getFbc(),visitorId:g.getVisitorId()},routing:{domain:window.location.hostname,active:P.resolve(),all:P.getAllPixelIds()},advancedMatching:u.getDiagnostics(),queueSize:v.length}},async getMatchQuality(e={}){let t=i.advancedMatching.enabled?await u.buildUserData(e):await u.normalizeAndHash(e);return{score:u.scoreMatchQuality(t),fields:Object.keys(t).filter(n=>t[n])}},addUserData(e,t="explicit"){u._mergeCapture(t,e)}};window.MetaTracker=T;if(window.MetaTrackerQueue&&Array.isArray(window.MetaTrackerQueue))for(let[e,...t]of window.MetaTrackerQueue){let n=T[e];typeof n=="function"&&n.apply(T,t)}var he=T;return re(ye);})();
//# sourceMappingURL=meta-tracker.min.js.map
