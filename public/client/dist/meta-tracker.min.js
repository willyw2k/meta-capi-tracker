"use strict";var MetaTrackerBundle=(()=>{var z=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var ie=Object.prototype.hasOwnProperty;var ae=(e,t)=>{for(var r in t)z(e,r,{get:t[r],enumerable:!0})},oe=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of re(t))!ie.call(e,n)&&n!==r&&z(e,n,{get:()=>t[n],enumerable:!(i=ne(t,n))||i.enumerable});return e};var se=e=>oe(z({},"__esModule",{value:!0}),e);var Te={};ae(Te,{MetaTracker:()=>M,default:()=>Re});var w="2.1.0";var U=[1e3,5e3,15e3],B=2e3,a={endpoint:"",apiKey:"",pixelId:"",pixels:[],autoPageView:!0,debug:!1,hashPii:!0,respectDnt:!1,batchEvents:!0,minMatchQuality:60,browserPixel:{enabled:!1,autoPageView:!0,syncEvents:!0},cookieKeeper:{enabled:!0,refreshInterval:864e5,maxAge:180,cookieNames:["_fbp","_fbc","_mt_id"]},adBlockRecovery:{enabled:!0,proxyPath:"/collect",useBeacon:!0,useImage:!0,customEndpoints:[]},advancedMatching:{enabled:!0,autoCaptureForms:!0,captureUrlParams:!0,captureDataLayer:!0,captureMetaTags:!0,autoIdentifyOnSubmit:!0,formFieldMap:{},dataLayerKey:"dataLayer",userDataKey:null},gtm:{enabled:!1,autoMapEcommerce:!0,pushToDataLayer:!0,dataLayerKey:"dataLayer",eventMapping:{}}},x=[],C=null,k=!1,_="fetch",f=!1,P=null;function H(e){Object.assign(a,e,{browserPixel:{...a.browserPixel,...e.browserPixel??{}},cookieKeeper:{...a.cookieKeeper,...e.cookieKeeper??{}},adBlockRecovery:{...a.adBlockRecovery,...e.adBlockRecovery??{}},advancedMatching:{...a.advancedMatching,...e.advancedMatching??{}},gtm:{...a.gtm,...e.gtm??{}}})}function K(e){k=e}function $(e){_=e}function V(e){f=e}function q(e){C=e}function G(e){P=e}function c(...e){a.debug&&console.log("[MetaTracker]",...e)}function d(...e){a.debug&&console.warn("[MetaTracker]",...e)}async function F(e){if(!e)return null;let t=new TextEncoder().encode(e.toString().trim().toLowerCase()),r=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}function E(e){return typeof e=="string"&&/^[a-f0-9]{64}$/.test(e)}function Q(){return`evt_${Date.now().toString(36)}_${Math.random().toString(36).substring(2,10)}`}function W(){let e=l("_mt_id");if(e)return e;let t="mt."+Date.now().toString(36)+"."+Math.random().toString(36).substring(2,12);return y("_mt_id",t),t}function X(){try{let e=window.location.hostname.split(".");return e.length<=1||/^\d+$/.test(e[e.length-1])?"":e.slice(-2).join(".")}catch{return""}}function I(e,t,r){let i=r*86400,n=location.protocol==="https:"?"; Secure":"",o=X(),s=o?`; domain=.${o}`:"";document.cookie=`${e}=${encodeURIComponent(t)}; path=/${s}; max-age=${i}; SameSite=Lax${n}`}function S(e){let t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?decodeURIComponent(t[2]):null}function ce(e){let t=X();document.cookie=`${e}=; path=/${t?`; domain=.${t}`:""}; max-age=0`}function l(e){let t=S(e);if(t)return t;try{return localStorage.getItem("mt_"+e)}catch{return null}}function y(e,t,r){r=r??(a.cookieKeeper.maxAge||180),I(e,t,r);try{localStorage.setItem("mt_"+e,t)}catch{}}function J(e){ce(e);try{localStorage.removeItem("mt_"+e)}catch{}}var h={async detect(){if(!a.adBlockRecovery.enabled)return!1;try{let e=a.endpoint.replace(/\/track\/?$/,"")+"/health",t=new AbortController,r=setTimeout(()=>t.abort(),3e3),i=await fetch(e,{method:"GET",signal:t.signal,cache:"no-store"});if(clearTimeout(r),!i.ok)throw new Error("Blocked");return!1}catch{return V(!0),c("AdBlockRecovery: DETECTED"),!0}},getEndpoint(e){return f&&a.adBlockRecovery.proxyPath?a.endpoint.replace(/\/api\/v1\/track\/?$/,"")+a.adBlockRecovery.proxyPath+e:a.endpoint+e},getFallbackEndpoints(e){let t=[this.getEndpoint(e)];for(let r of a.adBlockRecovery.customEndpoints??[])t.push(r+e);return t},disguisePayload(e){return f?{d:btoa(JSON.stringify(e)),t:Date.now(),v:w}:e},getHeaders(){let e={"Content-Type":"application/json"};return e[f?"X-Request-Token":"X-API-Key"]=a.apiKey,e}};function R(e){return f?h.getEndpoint(e):a.endpoint+e}async function de(e,t){let r=f?h.disguisePayload(t):t,i=await fetch(e,{method:"POST",headers:h.getHeaders(),body:JSON.stringify(r),keepalive:!0,credentials:"include"});if(!i.ok)throw new Error(`HTTP ${i.status}`);return i.json().catch(()=>({}))}function le(e,t){let r=f?h.disguisePayload(t):t,i=new Blob([JSON.stringify(r)],{type:"application/json"});if(!navigator.sendBeacon(e+"?api_key="+encodeURIComponent(a.apiKey),i))throw new Error("Beacon failed");return Promise.resolve({sent:!0})}function ue(e,t){return new Promise((r,i)=>{let n=new XMLHttpRequest;n.open("POST",e,!0);for(let[s,u]of Object.entries(h.getHeaders()))n.setRequestHeader(s,u);n.withCredentials=!0,n.timeout=1e4,n.onload=()=>n.status>=200&&n.status<300?r(JSON.parse(n.responseText||"{}")):i(new Error(`XHR ${n.status}`)),n.onerror=()=>i(new Error("XHR error")),n.ontimeout=()=>i(new Error("XHR timeout"));let o=f?h.disguisePayload(t):t;n.send(JSON.stringify(o))})}function me(e,t){return new Promise((r,i)=>{let n=new URLSearchParams({d:btoa(JSON.stringify(t)),k:a.apiKey,t:Date.now().toString()}),o=e.replace(/\/(event|batch)$/,"/pixel.gif")+"?"+n;if(o.length>4e3){i(new Error("Payload too large"));return}let s=new Image(1,1);s.onload=()=>r({sent:!0}),s.onerror=()=>i(new Error("Image pixel failed")),s.src=o})}async function T(e,t,r=0){let i=[{name:"fetch",fn:de},{name:"beacon",fn:le,skip:!a.adBlockRecovery.useBeacon},{name:"xhr",fn:ue},{name:"img",fn:me,skip:!a.adBlockRecovery.useImage}].filter(n=>!n.skip);for(let n of i){let o=e.includes(a.endpoint)?e.replace(a.endpoint,""):e.replace(/^https?:\/\/[^/]+/,"").replace(/.*\/api\/v1\/track/,""),s=f?h.getFallbackEndpoints(o):[e];for(let u of s)try{let p=await n.fn(u,t);return n.name!==_&&(c(`Transport: ${_} \u2192 ${n.name}`),$(n.name)),p}catch(p){c(`${n.name} \u2192 ${u}: ${p.message}`)}}if(r<U.length)return new Promise(n=>setTimeout(()=>n(T(e,t,r+1)),U[r]));d("All transports exhausted")}var g={init(){a.cookieKeeper.enabled&&(this.restoreCookies(),this.captureFbclid(),this.ensureFbp(),this.ensureVisitorId(),this.syncToServer(),this.scheduleRefresh(),c("CookieKeeper: ready",{fbp:this.getFbp(),fbc:this.getFbc()}))},restoreCookies(){for(let e of a.cookieKeeper.cookieNames??[])if(S(e))try{localStorage.setItem("mt_"+e,S(e))}catch{}else try{let t=localStorage.getItem("mt_"+e);t&&I(e,t,a.cookieKeeper.maxAge)}catch{}},captureFbclid(){try{let e=new URL(window.location.href).searchParams.get("fbclid");e&&y("_fbc",`fb.1.${Math.floor(Date.now()/1e3)}.${e}`,a.cookieKeeper.maxAge)}catch{}},ensureFbp(){l("_fbp")||y("_fbp",`fb.1.${Date.now()}.${Math.floor(Math.random()*2147483647)}`,a.cookieKeeper.maxAge)},ensureVisitorId(){l("_mt_id")||W()},async syncToServer(){let e={_fbp:l("_fbp"),_fbc:l("_fbc"),_mt_id:l("_mt_id"),_mt_em:l("_mt_em"),_mt_ph:l("_mt_ph")};if(!e._fbp&&!e._fbc&&!e._mt_id)return;let t=l("_mt_cookie_sync");if(!(t&&Date.now()-parseInt(t,10)<a.cookieKeeper.refreshInterval))try{await T(R("/cookie-sync"),{cookies:e,domain:window.location.hostname,max_age:a.cookieKeeper.maxAge}),y("_mt_cookie_sync",Date.now().toString(),1)}catch(r){d("CookieKeeper: sync failed",r.message)}},refreshCookies(){for(let e of a.cookieKeeper.cookieNames??[]){let t=l(e);t&&I(e,t,a.cookieKeeper.maxAge)}y("_mt_cookie_sync","0",1),this.syncToServer()},scheduleRefresh(){P&&clearInterval(P),G(setInterval(()=>this.refreshCookies(),a.cookieKeeper.refreshInterval)),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.restoreCookies()})},getFbp(){return l("_fbp")},getFbc(){return l("_fbc")},getVisitorId(){return l("_mt_id")}};var v={resolve(e){if(e=e??window.location.hostname,!a.pixels?.length)return a.pixelId?[a.pixelId]:[];let t=[],r=null;for(let i of a.pixels)if(!(!i.pixelId||!i.domains))for(let n of i.domains){if(n==="*"){r=i.pixelId;continue}if(this.matchDomain(e,n)){t.push(i.pixelId);break}}return!t.length&&r&&t.push(r),[...new Set(t)]},matchDomain(e,t){if(e===t)return!0;if(t.startsWith("*.")){let r=t.substring(2);return e.endsWith("."+r)||e===r}return e.endsWith("."+t)},getAllPixelIds(){return a.pixels?.length?[...new Set(a.pixels.map(e=>e.pixelId).filter(Boolean))]:a.pixelId?[a.pixelId]:[]}};var b={},te={em(e){return e?(e=e.trim().toLowerCase(),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?e:null):null},ph(e){if(!e)return null;let t=e.replace(/\D/g,"");return t.length<7?null:(t.startsWith("00")&&(t=t.substring(2)),t||null)},fn(e){if(!e)return null;e=e.trim().toLowerCase().replace(/^(mr|mrs|ms|miss|dr|prof)\.?\s*/i,""),e=e.replace(/[^a-z\s\u00C0-\u024F]/g,"");try{e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}catch{}return e.trim()||null},ln(e){return te.fn(e)},ge(e){return e?(e=e.trim().toLowerCase(),e.startsWith("m")||e==="male"?"m":e.startsWith("f")||e==="female"?"f":null):null},db(e){if(!e)return null;if(e=e.trim(),/^\d{8}$/.test(e))return e;let t=[/^(\d{4})-(\d{2})-(\d{2})$/,/^(\d{2})\/(\d{2})\/(\d{4})$/,/^(\d{2})-(\d{2})-(\d{4})$/];for(let r of t){let i=e.match(r);if(i)return i[1].length===4?i[1]+i[2]+i[3]:i[3]+i[1]+i[2]}return null},ct(e){if(!e)return null;e=e.trim().toLowerCase().replace(/[^a-z\s\u00C0-\u024F]/g,"");try{e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}catch{}return e.trim()||null},st(e){if(!e)return null;if(e=e.trim().toLowerCase(),/^[a-z]{2}$/.test(e))return e;let t=e.match(/\b([a-z]{2})\b/);return t?t[1]:e.substring(0,2)},zp(e){return e?(e=e.trim().toLowerCase().replace(/\s+/g,""),/^\d{5}(-\d{4})?$/.test(e)?e.substring(0,5):e||null):null},country(e){return e?(e=e.trim().toLowerCase(),/^[a-z]{2}$/.test(e)?e:{"united states":"us",usa:"us","united kingdom":"gb",uk:"gb",canada:"ca",australia:"au",germany:"de",france:"fr",indonesia:"id",japan:"jp",india:"in",brazil:"br",mexico:"mx",spain:"es",italy:"it",netherlands:"nl",singapore:"sg",malaysia:"my",philippines:"ph",thailand:"th",vietnam:"vn","south korea":"kr",china:"cn",taiwan:"tw","hong kong":"hk","new zealand":"nz",portugal:"pt",sweden:"se",norway:"no",denmark:"dk",finland:"fi",poland:"pl",cambodia:"kh",turkey:"tr",argentina:"ar",colombia:"co",chile:"cl",peru:"pe","south africa":"za",nigeria:"ng",egypt:"eg","saudi arabia":"sa","united arab emirates":"ae",uae:"ae",russia:"ru",ukraine:"ua",ireland:"ie",switzerland:"ch",austria:"at",belgium:"be","czech republic":"cz",romania:"ro"}[e]??(e.length===2?e:null)):null},external_id(e){return e?.trim()||null}},fe={em:{types:["email"],names:["email","e-mail","user_email","userEmail","customer_email","login","username","emailAddress","email_address"],ids:["email","user-email","customer-email","signup-email","login-email"],autocomplete:["email"],placeholders:["email","e-mail","your email","email address"]},ph:{types:["tel"],names:["phone","telephone","tel","mobile","phone_number","phoneNumber","cell","cellphone","mobile_number","contact_number","whatsapp"],ids:["phone","telephone","mobile","phone-number"],autocomplete:["tel","tel-national","tel-local"],placeholders:["phone","telephone","mobile","whatsapp","nomor telepon","hp"]},fn:{names:["first_name","firstName","fname","given-name","givenName","first","name_first","billing_first_name"],ids:["first-name","firstname","fname","given-name"],autocomplete:["given-name"],placeholders:["first name","given name","nama depan"]},ln:{names:["last_name","lastName","lname","family-name","familyName","surname","last","name_last","billing_last_name"],ids:["last-name","lastname","lname","family-name","surname"],autocomplete:["family-name"],placeholders:["last name","family name","surname","nama belakang"]},ct:{names:["city","town","billing_city","shipping_city","address_city"],ids:["city","billing-city","shipping-city"],autocomplete:["address-level2"],placeholders:["city","town","kota"]},st:{names:["state","province","region","billing_state","shipping_state"],ids:["state","province","region","billing-state"],autocomplete:["address-level1"],placeholders:["state","province","region","provinsi"]},zp:{names:["zip","zipcode","zip_code","postal","postal_code","postcode","billing_zip","billing_postcode","shipping_zip"],ids:["zip","zipcode","postal-code","postcode"],autocomplete:["postal-code"],placeholders:["zip","postal code","zip code","kode pos"]},country:{names:["country","country_code","countryCode","billing_country","shipping_country"],ids:["country","billing-country","shipping-country"],autocomplete:["country","country-name"],placeholders:["country","negara"]},ge:{names:["gender","sex"],ids:["gender","sex"],autocomplete:["sex"],placeholders:["gender","jenis kelamin"]},db:{names:["birthday","birthdate","date_of_birth","dob","dateOfBirth","birth_date","bday"],ids:["birthday","birthdate","dob","date-of-birth"],autocomplete:["bday"],placeholders:["birthday","date of birth","tanggal lahir"]}},Y={explicit:100,identify:90,form:80,form_prefill:70,url:60,dataLayer:50,customDataLayer:50,metatag:30},pe={email:"em",em:"em",user_email:"em",customerEmail:"em",phone:"ph",ph:"ph",telephone:"ph",mobile:"ph",phoneNumber:"ph",first_name:"fn",fn:"fn",firstName:"fn",givenName:"fn",last_name:"ln",ln:"ln",lastName:"ln",familyName:"ln",surname:"ln",gender:"ge",ge:"ge",sex:"ge",date_of_birth:"db",db:"db",birthday:"db",dob:"db",birthdate:"db",city:"ct",ct:"ct",town:"ct",state:"st",st:"st",province:"st",region:"st",zip:"zp",zp:"zp",zipcode:"zp",postal_code:"zp",postcode:"zp",country:"country",country_code:"country",countryCode:"country",external_id:"external_id",user_id:"external_id",userId:"external_id",customer_id:"external_id",customerId:"external_id"},Z={email:"em",phone:"ph",first_name:"fn",last_name:"ln",gender:"ge",date_of_birth:"db",city:"ct",state:"st",zip:"zp",zipcode:"zp",postal_code:"zp"},ee={em:"_mt_em",ph:"_mt_ph",external_id:"_mt_eid",fn:"_mt_fn",ln:"_mt_ln",ct:"_mt_ct",st:"_mt_st",zp:"_mt_zp",country:"_mt_country"},ge=["em","ph","fn","ln","ge","db","ct","st","zp","country","external_id"],he=["client_ip_address","client_user_agent","fbc","fbp","subscription_id","fb_login_id","lead_id"],m={init(){a.advancedMatching.enabled&&(c("AdvancedMatching: initializing"),a.advancedMatching.captureUrlParams&&this.captureFromUrl(),a.advancedMatching.captureMetaTags&&this.captureFromMetaTags(),a.advancedMatching.captureDataLayer&&this.captureFromDataLayer(),a.advancedMatching.autoCaptureForms&&this.watchForms(),c("AdvancedMatching: ready, captured:",Object.keys(b)))},normalize(e,t){if(E(t))return t;let r=te[e];return r?r(t):t?String(t).trim().toLowerCase():null},async normalizeAndHash(e){if(!e)return{};let t={};for(let r of ge){let i=e[r];if(!i)continue;if(E(i)){t[r]=i;continue}let n=this.normalize(r,i);n&&(t[r]=a.hashPii?await F(n)??void 0:n)}for(let r of he)e[r]&&(t[r]=e[r]);return t},detectFieldParam(e){let t=(e.type||"").toLowerCase(),r=(e.name||"").toLowerCase(),i=(e.id||"").toLowerCase(),n=(e.autocomplete||"").toLowerCase(),o=("placeholder"in e&&e.placeholder||"").toLowerCase();for(let[s,u]of Object.entries(a.advancedMatching.formFieldMap??{}))try{if(e.matches(s))return u}catch{}for(let[s,u]of Object.entries(fe))if(u.types?.includes(t)||u.names?.some(p=>r.includes(p))||u.ids?.some(p=>i.includes(p))||u.autocomplete?.includes(n)||u.placeholders?.some(p=>o.includes(p)))return s;return["name","full_name","fullname","customer_name"].includes(r)||["name","full-name","fullname"].includes(i)?"_fullname":null},scanForm(e){let t={},r=e.querySelectorAll("input, select, textarea");for(let i of r){if(["hidden","password","submit"].includes(i.type))continue;let n=i.value?.trim();if(!n)continue;let o=this.detectFieldParam(i);if(o)if(o==="_fullname"){let s=n.split(/\s+/);s.length>=2?(t.fn=t.fn||s[0],t.ln=t.ln||s.slice(1).join(" ")):t.fn=t.fn||n}else t[o]=t[o]||n}return t},watchForms(){document.addEventListener("submit",t=>{let r=t.target;if(!(r instanceof HTMLFormElement))return;let i=this.scanForm(r);Object.keys(i).length&&(this._mergeCapture("form",i),c("AdvancedMatching: form submit captured",Object.keys(i)),a.advancedMatching.autoIdentifyOnSubmit&&(i.em||i.ph)&&window.MetaTracker?.identify(i))},!0),document.addEventListener("change",t=>{let r=t.target;if(!(r instanceof HTMLInputElement)&&!(r instanceof HTMLSelectElement))return;let i=r.value?.trim();if(!i)return;let n=this.detectFieldParam(r);!n||n==="_fullname"||(this._mergeCapture("form",{[n]:i}),c("AdvancedMatching: field captured",n))},!0);let e=()=>{document.querySelectorAll("form").forEach(t=>{let r=this.scanForm(t);Object.keys(r).length&&(this._mergeCapture("form_prefill",r),c("AdvancedMatching: pre-filled form scanned",Object.keys(r)))}),typeof MutationObserver<"u"&&document.body&&new MutationObserver(r=>{for(let i of r)for(let n of i.addedNodes){if(!(n instanceof HTMLElement))continue;let o=n.tagName==="FORM"?[n]:[...n.querySelectorAll("form")];for(let s of o){let u=this.scanForm(s);Object.keys(u).length&&this._mergeCapture("form_prefill",u)}}}).observe(document.body,{childList:!0,subtree:!0})};document.body?e():document.addEventListener("DOMContentLoaded",e)},captureFromUrl(){try{let e=new URL(window.location.href).searchParams,t={};for(let o of["email","em","e","user_email","customer_email"]){let s=e.get(o);if(s?.includes("@")){t.em=s;break}}for(let o of["phone","ph","tel","mobile","whatsapp"]){let s=e.get(o);if(s&&s.replace(/\D/g,"").length>=7){t.ph=s;break}}let r=e.get("first_name")??e.get("fn");r&&(t.fn=r);let i=e.get("last_name")??e.get("ln");i&&(t.ln=i);for(let o of["external_id","eid","user_id","uid","customer_id","player_id"]){let s=e.get(o);if(s){t.external_id=s;break}}let n=e.get("country")??e.get("cc");n&&(t.country=n),Object.keys(t).length&&(this._mergeCapture("url",t),c("AdvancedMatching: URL params captured",Object.keys(t)))}catch{}},captureFromDataLayer(){let e=a.advancedMatching.dataLayerKey||"dataLayer",t=window[e];if(Array.isArray(t)){for(let n of t)this._extractFromDataLayerEntry(n);let i=t.push.bind(t);t.push=(...n)=>{let o=i(...n);for(let s of n)this._extractFromDataLayerEntry(s);return o}}let r=a.advancedMatching.userDataKey;r&&window[r]&&this._extractUserObject(window[r],"customDataLayer")},_extractFromDataLayerEntry(e){if(!e||typeof e!="object")return;let t=e;for(let n of["user","userData","user_data","customer","visitor","contact"])t[n]&&typeof t[n]=="object"&&this._extractUserObject(t[n],"dataLayer");let i=t.ecommerce?.purchase?.actionField;i?.email&&this._mergeCapture("dataLayer",{em:i.email}),this._extractUserObject(t,"dataLayer")},_extractUserObject(e,t){if(!e)return;let r={};for(let[i,n]of Object.entries(pe)){let o=e[i];o&&typeof o=="string"&&o.trim()&&(r[n]=o.trim())}Object.keys(r).length&&(this._mergeCapture(t,r),c("AdvancedMatching: data layer captured",Object.keys(r)))},captureFromMetaTags(){let e={};for(let r of document.querySelectorAll('script[type="application/ld+json"]'))try{let i=JSON.parse(r.textContent||"");if(i.email&&(e.em=i.email),i.telephone&&(e.ph=i.telephone),i.givenName&&(e.fn=i.givenName),i.familyName&&(e.ln=i.familyName),i.address&&typeof i.address=="object"){let n=i.address;n.addressLocality&&(e.ct=n.addressLocality),n.addressRegion&&(e.st=n.addressRegion),n.postalCode&&(e.zp=n.postalCode),n.addressCountry&&(e.country=n.addressCountry)}}catch{}let t=r=>document.querySelector(`meta[property="${r}"]`)?.content;t("profile:email")&&(e.em=t("profile:email")),t("profile:first_name")&&(e.fn=t("profile:first_name")),t("profile:last_name")&&(e.ln=t("profile:last_name")),t("profile:gender")&&(e.ge=t("profile:gender")),Object.keys(e).length&&(this._mergeCapture("metatag",e),c("AdvancedMatching: meta tags captured",Object.keys(e)))},_mergeCapture(e,t){for(let[r,i]of Object.entries(t)){if(!i)continue;let n=b[r],o=n?Y[n.source]??0:-1;(!n||(Y[e]??0)>=o)&&(b[r]={value:i,source:e})}},getCapturedData(){let e={};for(let[t,r]of Object.entries(b))e[t]=r.value;return e},async buildUserData(e={}){let t={...this.getCapturedData()};for(let[i,n]of Object.entries(ee))if(!t[i]&&n){let o=l(n);o&&(t[i]=o)}for(let[i,n]of Object.entries(e))n&&(t[Z[i]??i]=n);let r=await this.normalizeAndHash(t);if(r.fbp=r.fbp||g.getFbp()||void 0,r.fbc=r.fbc||g.getFbc()||void 0,r.client_user_agent=r.client_user_agent||navigator.userAgent,!r.external_id){let i=g.getVisitorId();i&&(r.external_id=await F(i)??void 0)}return r},scoreMatchQuality(e){let t={em:30,ph:25,external_id:15,fn:5,ln:5,ct:3,st:2,zp:3,country:2,ge:2,db:3,fbp:5,fbc:10,client_ip_address:3,client_user_agent:2},r=0;for(let[i,n]of Object.entries(t))e[i]&&(r+=n);return Math.min(r,100)},getDiagnostics(){let e={};for(let[t,r]of Object.entries(b))e[t]={source:r.source,hasValue:!0,isHashed:E(r.value)};return{capturedFields:Object.keys(b).length,fields:e,storedIdentity:{em:!!l("_mt_em"),ph:!!l("_mt_ph"),fn:!!l("_mt_fn"),ln:!!l("_mt_ln"),external_id:!!l("_mt_eid")}}},resetCapturedData(){b={}},aliasMap:Z,storageMap:ee};var ye=["PageView","ViewContent","AddToCart","AddPaymentInfo","AddToWishlist","CompleteRegistration","Contact","CustomizeProduct","Donate","FindLocation","InitiateCheckout","Lead","Purchase","Schedule","Search","StartTrial","SubmitApplication","Subscribe"],O={_loaded:!1,init(){if(!a.browserPixel.enabled||this._loaded)return;if(typeof window.fbq=="function"){c("BrowserPixel: fbq already present, initializing pixels"),this._initPixels(),this._loaded=!0;return}c("BrowserPixel: loading fbevents.js");let e=window.fbq=function(){e.callMethod?e.callMethod.apply(e,arguments):e.queue.push(arguments)};window._fbq||(window._fbq=e),e.push=e,e.loaded=!0,e.version="2.0",e.queue=[];let t=document.createElement("script");t.async=!0,t.src="https://connect.facebook.net/en_US/fbevents.js";let r=document.getElementsByTagName("script")[0];if(r&&r.parentNode)r.parentNode.insertBefore(t,r);else{let i=()=>{let n=document.getElementsByTagName("script")[0];n&&n.parentNode?n.parentNode.insertBefore(t,n):document.head.appendChild(t)};document.body?i():document.addEventListener("DOMContentLoaded",i)}this._initPixels(),this._loaded=!0},_initPixels(){let e=v.getAllPixelIds();if(!e.length){d("BrowserPixel: no pixel IDs configured");return}for(let t of e)window.fbq("init",t),c("BrowserPixel: init pixel",t);a.browserPixel.autoPageView&&(window.fbq("track","PageView"),c("BrowserPixel: PageView fired"))},trackEvent(e,t,r={}){if(!a.browserPixel.enabled||!a.browserPixel.syncEvents||typeof window.fbq!="function")return;let i=ye.includes(e),n={...r},o={eventID:t};i?window.fbq("track",e,n,o):window.fbq("trackCustom",e,n,o),c("BrowserPixel: synced",e,"eventID:",t)}};var _e={page_view:"PageView",view_item:"ViewContent",view_item_list:"ViewContent",select_item:"ViewContent",add_to_cart:"AddToCart",add_to_wishlist:"AddToWishlist",begin_checkout:"InitiateCheckout",add_payment_info:"AddPaymentInfo",purchase:"Purchase",refund:"",remove_from_cart:"",sign_up:"CompleteRegistration",generate_lead:"Lead",search:"Search",login:"",view_cart:"ViewContent",add_shipping_info:"AddPaymentInfo",select_promotion:"ViewContent"};function be(e,t,r){let i={},n=t??{};return n.value!==void 0&&(i.value=Number(n.value)),n.currency&&(i.currency=String(n.currency)),n.transaction_id&&(i.order_id=String(n.transaction_id)),n.search_term&&(i.search_string=String(n.search_term)),r.search_term&&(i.search_string=String(r.search_term)),Array.isArray(n.items)&&n.items.length&&(i.content_ids=n.items.map(o=>o.item_id??o.item_name??"").filter(Boolean),i.contents=n.items.map(o=>({id:String(o.item_id??o.item_name??""),quantity:o.quantity??1,item_price:o.price})),i.num_items=n.items.reduce((o,s)=>o+(s.quantity??1),0),i.content_type="product",n.items[0]?.item_name&&(i.content_name=n.items[0].item_name),n.items[0]?.item_category&&(i.content_category=n.items[0].item_category)),i.value===void 0&&i.contents?.length&&(i.value=i.contents.reduce((o,s)=>o+(s.item_price??0)*(s.quantity??1),0)),i}function we(e){let t={},r=["user","userData","user_data","customer","visitor","contact"];for(let i of r)if(e[i]&&typeof e[i]=="object"){let n=e[i];(n.email||n.em)&&(t.em=String(n.email??n.em)),(n.phone||n.ph)&&(t.ph=String(n.phone??n.ph)),(n.first_name||n.fn||n.firstName)&&(t.fn=String(n.first_name??n.fn??n.firstName)),(n.last_name||n.ln||n.lastName)&&(t.ln=String(n.last_name??n.ln??n.lastName)),(n.external_id||n.user_id||n.userId)&&(t.external_id=String(n.external_id??n.user_id??n.userId)),(n.city||n.ct)&&(t.ct=String(n.city??n.ct)),(n.state||n.st)&&(t.st=String(n.state??n.st)),(n.zip||n.zp||n.postal_code)&&(t.zp=String(n.zip??n.zp??n.postal_code)),(n.country||n.country_code)&&(t.country=String(n.country??n.country_code))}return e.user_id&&(t.external_id=t.external_id||String(e.user_id)),e.userId&&(t.external_id=t.external_id||String(e.userId)),t}var N=!1,j=null,L={init(){if(a.gtm.enabled&&!N)try{c("GTM: initializing dataLayer bridge");let e=a.gtm.dataLayerKey||"dataLayer",t=window[e];Array.isArray(t)||(window[e]=[],c("GTM: created",e));let r=window[e];if(a.gtm.autoMapEcommerce)for(let i of r)try{this._processEntry(i)}catch(n){d("GTM: error processing existing dataLayer entry",n)}j=r.push.bind(r),r.push=(...i)=>{let n=j(...i);if(a.gtm.autoMapEcommerce)for(let o of i)try{this._processEntry(o)}catch(s){d("GTM: error processing dataLayer push",s)}return n},N=!0,c("GTM: dataLayer bridge active")}catch(e){d("GTM: failed to initialize dataLayer bridge",e)}},_processEntry(e){if(!e||typeof e!="object")return;let t=e,r=t.event;if(!r||typeof r!="string"||r.startsWith("gtm.")||t._source==="meta-capi-tracker")return;let i=this._resolveEventName(r);if(!i)return;let n={},o={};try{let s=t.ecommerce;n=be(r,s,t),o=we(t)}catch(s){d("GTM: error extracting data from dataLayer entry",r,s);return}c("GTM: mapping",r,"\u2192",i),window.MetaTracker&&typeof window.MetaTracker.track=="function"&&window.MetaTracker.track(i,n,o).catch(s=>{d("GTM: failed to track mapped event",i,s)})},_resolveEventName(e){let t=a.gtm.eventMapping[e];if(t)return t;let r=_e[e];return r!==void 0&&r||null},pushToDataLayer(e,t={}){try{let r=a.gtm.dataLayerKey||"dataLayer",i=window[r];if(!Array.isArray(i)){d("GTM: dataLayer not found, cannot push event");return}(j??i.push.bind(i))({event:e,...t,_source:"meta-capi-tracker"}),c("GTM: pushed to dataLayer:",e)}catch(r){d("GTM: error pushing to dataLayer",e,r)}},notifyDataLayer(e,t,r={}){if(!(!a.gtm.enabled||!a.gtm.pushToDataLayer))try{this.pushToDataLayer("meta_capi_event",{meta_event_name:e,meta_event_id:t,meta_custom_data:r})}catch(i){d("GTM: error notifying dataLayer",e,i)}},isInitialized(){return N}};async function ve(e){if(!e.length)return;let t=e.length===1?R("/event"):R("/batch"),r=e.length===1?e[0]:{events:e};try{await T(t,r)}catch(i){d("Send failed:",i)}}function D(){x.length&&ve(x.splice(0,50))}function xe(e){x.push(e),a.batchEvents?(C&&clearTimeout(C),q(setTimeout(D,B))):D()}var M={VERSION:w,async init(e){return k?(d("Already initialized"),this):!e.endpoint||!e.apiKey?(d("Missing: endpoint, apiKey"),this):!("pixelId"in e&&e.pixelId)&&!("pixels"in e&&e.pixels?.length)?(d("Missing: pixelId or pixels[]"),this):e.respectDnt&&(navigator.doNotTrack==="1"||window.doNotTrack==="1")?this:(H(e),K(!0),c("Initialized v"+w),g.init(),m.init(),O.init(),L.init(),a.adBlockRecovery.enabled&&h.detect().then(t=>{t&&c("Ad blocker recovery: ACTIVE")}),a.autoPageView&&this.trackPageView(),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&D()}),window.addEventListener("beforeunload",D),this)},async track(e,t={},r={},i={}){if(!k){d("Not initialized");return}let n=i.event_id??Q(),o=a.advancedMatching.enabled?await m.buildUserData(r):await m.normalizeAndHash(r),s=m.scoreMatchQuality(o);if(c(`Match quality: ${s}/100`),s<a.minMatchQuality){d(`Match quality ${s} below threshold ${a.minMatchQuality}, skipping event`);return}let u=i.pixel_id?[i.pixel_id]:v.resolve();if(!u.length){d("No pixel for:",window.location.hostname);return}for(let p of u){let A={pixel_id:p,event_name:e,event_id:u.length>1?`${n}_${p.slice(-4)}`:n,event_time:Math.floor(Date.now()/1e3),event_source_url:window.location.href,action_source:i.action_source??"website",user_data:{...o},match_quality:s,visitor_id:g.getVisitorId()??null};Object.keys(t).length&&(A.custom_data=t),c("Track:",e,"\u2192",p,`(match: ${s})`),xe(A),O.trackEvent(e,A.event_id,t)}return L.notifyDataLayer(e,n,t),n},trackPageView(e={}){return this.track("PageView",{},e)},trackViewContent(e={},t={}){return this.track("ViewContent",e,t)},trackAddToCart(e={},t={}){return this.track("AddToCart",e,t)},trackPurchase(e={},t={}){return this.track("Purchase",e,t)},trackLead(e={},t={}){return this.track("Lead",e,t)},trackCompleteRegistration(e={},t={}){return this.track("CompleteRegistration",e,t)},trackInitiateCheckout(e={},t={}){return this.track("InitiateCheckout",e,t)},trackSearch(e={},t={}){return this.track("Search",e,t)},trackToPixel(e,t,r={},i={}){return this.track(t,r,i,{pixel_id:e})},async identify(e={}){if(!k){d("Not initialized");return}let t={};for(let[i,n]of Object.entries(e))n&&(t[m.aliasMap[i]??i]=n);let r=await m.normalizeAndHash(t);for(let[i,n]of Object.entries(m.storageMap)){let o=r[i];o&&n&&y(n,o,a.cookieKeeper.maxAge)}m._mergeCapture("identify",t),c("Identify:",Object.keys(r).filter(i=>r[i]&&!["client_user_agent","fbp","fbc"].includes(i))),g.syncToServer()},clearIdentity(){["_mt_em","_mt_ph","_mt_fn","_mt_ln","_mt_eid","_mt_ct","_mt_st","_mt_zp","_mt_country"].forEach(J),m.resetCapturedData(),c("Identity cleared")},addPixel(e,t){a.pixels.push({pixelId:e,domains:Array.isArray(t)?t:[t]})},removePixel(e){a.pixels=a.pixels.filter(t=>t.pixelId!==e)},refreshCookies(){g.refreshCookies()},flush(){D()},isAdBlocked(){return f},getTransport(){return _},getDebugInfo(){return{version:w,initialized:k,transport:_,adBlockDetected:f,config:{endpoint:a.endpoint,pixelId:a.pixelId,pixelCount:a.pixels.length},cookies:{fbp:g.getFbp(),fbc:g.getFbc(),visitorId:g.getVisitorId()},routing:{domain:window.location.hostname,active:v.resolve(),all:v.getAllPixelIds()},advancedMatching:m.getDiagnostics(),queueSize:x.length}},async getMatchQuality(e={}){let t=a.advancedMatching.enabled?await m.buildUserData(e):await m.normalizeAndHash(e);return{score:m.scoreMatchQuality(t),fields:Object.keys(t).filter(r=>t[r])}},addUserData(e,t="explicit"){m._mergeCapture(t,e)},pushToDataLayer(e,t={}){L.pushToDataLayer(e,t)}};window.MetaTracker=M;if(window.MetaTrackerQueue&&Array.isArray(window.MetaTrackerQueue))for(let[e,...t]of window.MetaTrackerQueue){let r=M[e];typeof r=="function"&&r.apply(M,t)}var Re=M;return se(Te);})();
//# sourceMappingURL=meta-tracker.min.js.map
